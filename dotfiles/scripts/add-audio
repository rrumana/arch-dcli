#!/bin/bash

echo "Usage: add-audio video.mp4 audio.flac name=\"output.mp4\""
echo "Supports: mp4, mkv, avi, mov, webm (video) | flac, mp3, wav, aac, ogg (audio)"
echo ""

# Parse arguments
video=""
audio=""
name=""

for arg in "$@"; do
	if [[ $arg == name=* ]]; then
		name="${arg#name=}"
		name="${name#\"}"
		name="${name%\"}"
	elif [[ -z "$video" ]]; then
		video="$arg"
	elif [[ -z "$audio" ]]; then
		audio="$arg"
	fi
done

# If no arguments, check for hardcoded values
if [ -z "$video" ] || [ -z "$audio" ] || [ -z "$name" ]; then
	# Set your paths here (edit these if running without arguments)
	video=""
	audio=""
	name=""

	if [ -z "$video" ] || [ -z "$audio" ] || [ -z "$name" ]; then
		echo "Error: Missing arguments or hardcoded values"
		exit 1
	fi
fi

ffmpeg -i "$video" -i "$audio" -c:v copy -map 0:v:0 -map 1:a:0 -shortest -c:a aac -b:a 320k "$name"

echo "Created: $name"

# What each flag does:
# -i "$video"        = input video file
# -i "$audio"        = input audio file
# -c:v copy          = copy video without re-encoding (no quality loss)
# -map 0:v:0         = use video from first input (the video file)
# -map 1:a:0         = use audio from second input (the audio file)
# -shortest          = cut audio to match video length
# -c:a aac           = encode audio as AAC
# -b:a 320k          = audio bitrate 320kbps (high quality)
# "$name"            = output file name
