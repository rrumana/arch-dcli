#!/bin/bash
# quick tmux session picker with fzf

dirs=(
	"$HOME/.config"
	"$HOME/100xCodes"
	"$HOME/100xCodes/Cohort-3-WebDev"
	"$HOME/100xCodes/Projects"
	"$HOME/Downloads"
	"$HOME/Documents"
	"$HOME/Testing-repo"
	"$HOME/Projects"
)

# these are added as-is, no subdir scan
extras=(
	"$HOME/100xCodes"
)

all=()
for d in "${dirs[@]}"; do
	mapfile -t found < <(fd --type dir --max-depth 1 --full-path "" "$d" 2>/dev/null)
	all+=("${found[@]}")
done
all+=("${extras[@]}")

if [[ $# -eq 1 ]]; then
	selected=$1
else
	selected=$(printf '%s\n' "${all[@]}" | sed "s|^$HOME/||" | fzf)
	[[ -n $selected ]] && selected="$HOME/$selected"
fi

[[ -z $selected ]] && exit 0

name=$(basename "$selected" | tr '.' '_')

# tmux not running
if [[ -z $TMUX ]] && ! pgrep -q tmux; then
	tmux new-session -s "$name" -c "$selected"
	exit 0
fi

# create session if needed
tmux has-session -t "$name" 2>/dev/null || tmux new-session -ds "$name" -c "$selected"

# attach or switch
tmux switch-client -t "$name" 2>/dev/null || tmux attach -t "$name"
